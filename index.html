<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LessonFinder</title>

  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="lessons.js"></script>

  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
  />

  <!-- Custom CSS -->
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div id="app" class="container">
    <header>
  <div class="header-left">
    <h1>~LessonFinder</h1>
    <div class="muted"><em>Select the Required Lessons and Add to Cart!</em></div>
  </div>

  <div class="header-center">
    <input
      type="text"
      v-model="searchQuery"
      placeholder="Search"
      class="search-box"
    />
  </div>

  <div class="header-right">
    <button @click="toggleCart" :disabled="cart.length === 0 && !orderPlaced">
      <i class="fa fa-cart-plus"></i>
      Cart
      <span class="cart-count">{{ totalCartItems }}</span>
    </button>
  </div>
</header>

    <!-- Lessons Page -->
    <div class="content-layout" v-if="showLessons">
      <!-- Sort Panel -->
      <div class="sort-panel">
        <div class="sort-group">
          <h4>Sort by</h4>
          <label><input type="radio" value="subject" v-model="sortAttr" /> Subject</label>
          <label><input type="radio" value="location" v-model="sortAttr" /> Location</label>
          <label><input type="radio" value="price" v-model="sortAttr" /> Price</label>
          <label><input type="radio" value="spaces" v-model="sortAttr" /> Availability</label>
        </div>

        <div class="sort-group">
          <h4>Order</h4>
          <label><input type="radio" value="asc" v-model="sortOrder" /> Ascending</label>
          <label><input type="radio" value="desc" v-model="sortOrder" /> Descending</label>
        </div>
      </div>

      <!-- Lessons List -->
      <section class="lessons-section">
        <h3>Available Lessons ({{ lessons.length }})</h3>
        <div class="grid">
          <div class="card" v-for="lesson in sortedLessons" :key="lesson.id">
            <div class="lesson-info">
              <div class="lesson-text">
                <p>Subject: {{ lesson.subject }}</p>
                <p>Location: {{ lesson.location }}</p>
                <p>Price: £{{ lesson.price.toFixed(2) }}</p>
                <p>Spaces: {{ lesson.spaces }}</p>
              </div>
              <div class="lesson-icon">
                <i :class="lesson.icon"></i>
              </div>
            </div>

            <!-- ⭐ Rating -->
            <div class="rating">
              <i v-for="n in 5" :key="n"
                 :class="n <= lesson.rating ? 'fa-solid fa-star' : 'fa-regular fa-star'">
              </i>
            </div>

            <div class="cart-action">
              <button :disabled="lesson.spaces === 0" @click="addToCart(lesson)">
                <i class="fa fa-cart-plus"></i> Add to Cart
              </button>
              <span v-if="lesson.spaces === 0" class="stock-message out">All Out!</span>
              <span v-else-if="lesson.spaces < 5" class="stock-message low">Only {{ lesson.spaces }} left!</span>
              <span v-else class="stock-message available">Buy Now!</span>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Cart & Checkout Page -->
    <section v-else>
      <h3>Your Shopping Cart ({{ cart.length }})</h3>

      <!-- Cart Empty -->
      <div v-if="cart.length === 0 && !orderPlaced" class="muted">Cart is empty.</div>

      <!-- Cart Items -->
      <div v-else-if="cart.length > 0" class="grid">
        <div class="card" v-for="item in cart" :key="item.lessonId">
          <div class="lesson-info">
            <div class="lesson-text">
              <p>Subject: {{ item.subject }}</p>
              <p>Location: {{ item.location }}</p>
              <p>Price: £{{ item.price.toFixed(2) }}</p>
              <p>Quantity: {{ item.quantity }}</p>
              <p>Total: £{{ (item.price * item.quantity).toFixed(2) }}</p>
            </div>
            <div class="lesson-icon">
              <i :class="lessons.find(l => l.id === item.lessonId)?.icon"></i>
            </div>
          </div>
          <button @click="removeFromCart(item)" class="remove-btn">
            <i class="fa fa-trash"></i> Remove
          </button>
        </div>
      </div>

      <!-- Checkout Form -->
      <div v-if="cart.length > 0 && !orderPlaced" class="checkout-section">
        <h4>Checkout</h4>
        <div class="form-row">
          <input v-model="firstName" placeholder="First Name" />
          <input v-model="lastName" placeholder="Last Name" />
        </div>
        <div class="form-row">
          <input v-model="phone" placeholder="Phone Number" />
        </div>
        <div class="form-row">
          <input v-model="address" placeholder="Address" />
        </div>
        <div class="form-row">
          <input v-model="checkoutCity" placeholder="City (letters only)" />
          <select v-model="checkoutState">
            <option disabled value="">Select UK State</option>
            <option>England</option>
            <option>Scotland</option>
            <option>Wales</option>
            <option>Northern Ireland</option>
          </select>
        </div>
        <div class="form-row">
          <input v-model="zip" placeholder="Zip / Postal Code" />
        </div>

        <div class="gift-options">
          <input type="checkbox" id="gift" v-model="shipAsGift" />
          <label for="gift">Ship As Gift?</label>
        </div>

        <div class="radio-options">
          <label><input type="radio" value="Home" v-model="shippingType" /> Home</label>
          <label><input type="radio" value="Business" v-model="shippingType" /> Business</label>
        </div>

        <button class="checkout-btn" @click="submitOrder" :disabled="!canCheckout">
          Checkout
        </button>
      </div>

      <!-- Order Summary -->
      <div v-if="orderPlaced" class="checkout-summary">
        <h3><i class="fa fa-check-circle"></i> Order Confirmed!</h3>
        <p><strong>First Name:</strong> {{ orderDetails.firstName }}</p>
        <p><strong>Last Name:</strong> {{ orderDetails.lastName }}</p>
        <p><strong>Address:</strong> {{ orderDetails.address }}</p>
        <p><strong>City:</strong> {{ orderDetails.city }}</p>
        <p><strong>State:</strong> {{ orderDetails.state }}</p>
        <p><strong>Zip:</strong> {{ orderDetails.zip }}</p>
        <p><strong>Shipping Method:</strong> {{ orderDetails.shippingType }}</p>
        <p><strong>Gift Option:</strong> {{ orderDetails.giftOption }}</p>
        <p><strong>Total:</strong> £{{ orderDetails.total }}</p>
        <button class="go-back-btn" @click="goBackToLessons">Go Back to Lessons</button>
      </div>
    </section>

    <div class="footer">~ Lessons App ~</div>
  </div>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
  return {
    showLessons: true,
    sortAttr: 'price',
    sortOrder: 'asc',
    lessons: lessons,
    cart: [],
    firstName: '',
    lastName: '',
    phone: '',
    address: '',
    checkoutCity: '',
    checkoutState: '',
    zip: '',
    shipAsGift: false,
    shippingType: 'Home',
    orderPlaced: false,
    orderDetails: {},
    searchQuery: ''
  };
},
      computed: {
        sortedLessons() {
  const query = this.searchQuery.trim().toLowerCase();
  let filtered = this.lessons.filter(l => {
    // Convert values to strings for comparison
    const subject = l.subject.toLowerCase();
    const location = l.location.toLowerCase();
    const price = l.price.toString();
    const spaces = l.spaces.toString();

    // Match if query is found in any field
    return (
      subject.includes(query) ||
      location.includes(query) ||
      price.includes(query) ||
      spaces.includes(query)
    );
  });

  // Apply sorting
  const order = this.sortOrder === 'asc' ? 1 : -1;
  filtered.sort((a, b) => {
    let A = a[this.sortAttr];
    let B = b[this.sortAttr];
    if (typeof A === 'string') A = A.toLowerCase();
    if (typeof B === 'string') B = B.toLowerCase();
    if (A < B) return -1 * order;
    if (A > B) return 1 * order;
    return 0;
  });

  return filtered;
},
        totalCartItems() {
          return this.cart.reduce((s, i) => s + i.quantity, 0);
        },
        cartTotal() {
          return this.cart.reduce((s, i) => s + i.price * i.quantity, 0);
        },
        canCheckout() {
          const firstNameValid = /^[A-Za-z\s]+$/.test(this.firstName.trim());
          const lastNameValid = /^[A-Za-z\s]+$/.test(this.lastName.trim());
          const phoneValid = /^\d+$/.test(this.phone.trim());
          const zipValid = /^\d{5,10}$/.test(this.zip.trim());
          const cityValid = /^[A-Za-z\s]+$/.test(this.checkoutCity.trim());
          const stateValid = this.checkoutState !== '';
          return (
            firstNameValid &&
            lastNameValid &&
            phoneValid &&
            zipValid &&
            this.address.trim() &&
            cityValid &&
            stateValid &&
            this.cart.length > 0
          );
        }
      },
      methods: {
  addToCart(lesson) {
    if (lesson.spaces === 0) return;
    lesson.spaces--;
    const existing = this.cart.find(i => i.lessonId === lesson.id);
    if (existing) existing.quantity++;
    else {
      this.cart.push({
        lessonId: lesson.id,
        subject: lesson.subject,
        location: lesson.location,
        price: lesson.price,
        quantity: 1
      });
    }
  },
  removeFromCart(item) {
    const idx = this.cart.findIndex(i => i.lessonId === item.lessonId);
    if (idx === -1) return;
    const lesson = this.lessons.find(l => l.id === item.lessonId);
    if (lesson) lesson.spaces += item.quantity;
    this.cart.splice(idx, 1);
  },
  toggleCart() {
    this.showLessons = !this.showLessons;
  },
  submitOrder() {
  if (!this.canCheckout) return;

  // ✅ Show alert
  alert("Order submitted!");

  // ✅ Save entered data before clearing
  this.orderDetails = {
    firstName: this.firstName,
    lastName: this.lastName,
    address: this.address,
    city: this.checkoutCity,
    state: this.checkoutState,
    zip: this.zip,
    shippingType: this.shippingType,
    giftOption: this.shipAsGift ? "Send as Gift" : "Do Not Send as Gift",
    total: this.cartTotal.toFixed(2)
  };

  // ✅ Switch to confirmation view
  this.orderPlaced = true;
  this.showLessons = false;

  // ✅ Now clear everything safely (after copying)
  this.cart = [];
  this.firstName = '';
  this.lastName = '';
  this.phone = '';
  this.address = '';
  this.checkoutCity = '';
  this.checkoutState = '';
  this.zip = '';
  this.shipAsGift = false;
  this.shippingType = 'Home';
},
  goBackToLessons() {
    this.orderPlaced = false;
    this.showLessons = true;
  }
}
    }).mount('#app');
  </script>
</body>
</html>
